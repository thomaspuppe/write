<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>wryte.</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
          body {
            font-family: mono, monospace;
            font-size: calc(0.4em + 0.7vw);
            max-width: 70ch;
            margin: 3rem auto;
          }
          h1 {
            font-size: calc(4.4em + 0.7vw);
          }
          #writer {
            caret-color: blue;
            white-space: break-spaces;
          }
        </style>
    </head>
    <body>

      <h1>wryte.</h1>
      <pre id="writer" contenteditable="true" onfocus="this.selectionStart = this.selectionEnd = this.innerText.length;"></pre>

      <aside>
        <button id="empty">empty text</button>
      </aside>

      <script>
        var localStorageAvailable = true;
        $writer = document.getElementById('writer');

        try {
            var storedText = window.localStorage.getItem('wryte_content');
            if (storedText) {
                $writer.innerText = storedText;
            }
        } catch {
            localStorageAvailable = false;
        }

        // Boah, echt? (https://jsfiddle.net/nrx9yvw9/5/)
        function createRange(node, chars, range) {
            if (!range) {
                range = document.createRange()
                range.selectNode(node);
                range.setStart(node, 0);
            }

            if (chars.count === 0) {
                range.setEnd(node, chars.count);
            } else if (node && chars.count >0) {
                if (node.nodeType === Node.TEXT_NODE) {
                    if (node.textContent.length < chars.count) {
                        chars.count -= node.textContent.length;
                    } else {
                         range.setEnd(node, chars.count);
                         chars.count = 0;
                    }
                } else {
                    for (var lp = 0; lp < node.childNodes.length; lp++) {
                        range = createRange(node.childNodes[lp], chars, range);

                        if (chars.count === 0) {
                           break;
                        }
                    }
                }
           } 

           return range;
        };

        $writer.focus();
        var selection = window.getSelection();
        var range = createRange($writer, { count: $writer.innerText.length });
        if (range) {
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        }

        $writer.addEventListener('keydown', function(evt) {
            if ([8,37,38,39,40,46].indexOf(event.keyCode)>-1) {
                evt.preventDefault();
            }
            
            if (localStorageAvailable && (event.keyCode<49 || event.keyCode>90)) {
                // TODO: Auch bei Satzzeichen? Immer bei nicht-Buchstaben? 
                // Lieber Regex auf Buchstaben??
                try {
                    window.localStorage.setItem('wryte_content', evt.target.innerText);
                } catch(error) {
                    localStorageAvailable = false;
                }
            }
        });

        document.querySelector('#empty').addEventListener('click', function(evt) {
            evt.preventDefault();
            if (localStorageAvailable) {
                try {
                    window.localStorage.removeItem('wryte_content');
                } catch(error) {
                    localStorageAvailable = false;
                }
            }
            $writer.innerText = '';
            $writer.focus();
        });
      </script>
    </body>
</html>
<!-- 

# Inspiration
- https://couchto50k.club/write-only/ 
  > What ist this? I cannot correct it?My my my. But this is interesting. Was war hier nochmal der Gag? Dass alle paar Sekunden der Text weggespeichert wird. Nice.Ne, warte nicht alle paar Sekunden. Sondern bei jedem Leerzeichen.Das ist ja auch ne Idee, dass ich innerhalb von Wörtern korrgieren kann, aber nicht mehr.Und ddass der dgeschriebene Text nach ein paar Zeilen verschwindet, ist auch eher ein Featur eals ein Bug. sehr schön gemacht.

# TODO

## Features

[x] Contenteditable mit Autofocus
[x] Keys: 8,37,38,39,40,46
[ ] Überschrift wird kleiner, wenn man ein paar Buchstaben geschrieben hat.
[ ] Infotext verschwindet, wenn man ein paar Buchstaben geschrieben hat.
[x] Text in Localstorage retten, für den Fall dass man reloadet
[x] Button für die localstorage-Löschung
[ ] Geil stylen
    - die Überschrift ist hässlich mit dem Kerning
[ ] Dark Mode mit hübschem Icon
[ ] alten Text abdunkeln?
[ ] kann ich per JS den Text als .txt Datei zum Download anbieten?
[ ] beim Fokussieren den Cursor immer and Ende zwingen
[ ] Toggle Fullscreen
[ ] Word counter (Leerzeichen Counter :-))

## Marketing

[ ] Domain
    - writeforward.com?
    - justwrite.dev
    - justwrite.tools
    - getjustwrite.com
    - wryte.app
    - wryte.now.sh (!)
[ ] Patreon/Buymeabeer

-->
